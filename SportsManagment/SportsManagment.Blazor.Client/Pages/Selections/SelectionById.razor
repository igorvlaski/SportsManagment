@page "/selection/{SelectionId:guid}"

<PageTitle>Selekcija</PageTitle>

@if (selection != null)
{
    <MudText Typo="Typo.h5">Uredi prisotnosti v selekciji: @selection.SelectionName</MudText>


    <MudTable Items="selection.Players">
        <ToolBarContent>
            <MudTooltip Text="Posodobi selekcijo" Arrow="true" Placement="Placement.Top">
                <MudIconButton OnClick="@(() => GoToEditSelection(selection.Id))" Icon="@Icons.Material.Filled.Edit"></MudIconButton>
            </MudTooltip>
        </ToolBarContent>

        <HeaderContent>
            <MudTh>Ime igralca</MudTh>
            <MudTh>Dodaj plačilo</MudTh>
            @foreach (var day in currentWeekDays)
            {
                <MudTh>@day.ToString("ddd dd")</MudTh>
            }
        </HeaderContent>

        <RowTemplate>
            <MudTd DataLabel="Ime igralca">
                <MudTooltip Text="Pojdi na igralca" Arrow="true" Placement="Placement.Top">
                <MudButton OnClick="@(() => GoToPlayerDetails(context.Id))">@($"{context.FirstName} {context.LastName}")</MudButton>
                </MudTooltip>
            </MudTd>
            <MudTd>
                <MudTooltip Text="Dodaj plačilo" Arrow="true" Placement="Placement.Top">
                    <MudIconButton Icon="@Icons.Material.Outlined.PostAdd" Color="Color.Success" Variant="Variant.Outlined" OnClick="@(() => OpenAddPaymentDialog(context.Id))" />
                </MudTooltip>
            </MudTd>

            @foreach (var day in currentWeekDays)
            {
                var dayDateOnly = DateOnly.FromDateTime(day);
                var attendanceRecord = trainingAttendances.FirstOrDefault(a => a.PlayerId == context.Id && a.Date == dayDateOnly);
                <MudTd>
                    <MudCheckBox Color="Color.Primary" UnCheckedColor="Color.Error" Checked="@(attendanceRecord != null)"
                                 CheckedChanged="@((bool value) => OnAttendanceCheckboxChanged(value, context.Id, dayDateOnly, attendanceRecord?.Id))"></MudCheckBox>
                </MudTd>
            }
        </RowTemplate>

        <PagerContent>
            <MudTablePager />
        </PagerContent>
    </MudTable>
}
else
{
    <LoadingIndicator />
}
